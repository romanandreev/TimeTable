// Generated by CoffeeScript 1.4.0
(function() {

  window.getTimeTableJson = function() {
    var getAttr, getRowJson, getWeekday, wd, weekdays, _i, _len, _ref;
    getAttr = function(lesson, attr) {
      return $(lesson.cell).find(attr).text().trim();
    };
    getRowJson = function(row) {
      var all_lessons, cols, getLessonJson, l, top, _i, _len, _results;
      row = $(row);
      top = row.hasClass('top');
      cols = row.find('td.lesson');
      all_lessons = [];
      if (cols.length === 1) {
        all_lessons = [
          {
            cell: cols[0],
            spec: 'all'
          }
        ];
      } else {
        all_lessons = [
          {
            cell: cols[0],
            spec: 'sa'
          }, {
            cell: cols[1],
            spec: 'sm'
          }, {
            cell: cols[2],
            spec: 'mm'
          }
        ];
      }
      getLessonJson = function(lesson) {
        var cell, id, json, rowspan;
        json = {
          spec: lesson.spec,
          location: getAttr(lesson, '.loc'),
          course: {}
        };
        cell = $(lesson.cell);
        id = cell.find('.lessonid')[0];
        if (id != null) {
          json.course.id = $(id).attr('value');
        } else {
          json.course.name = getAttr(lesson, '.name');
          json.course.prof = getAttr(lesson, '.prof');
        }
        rowspan = parseInt(cell.attr('rowspan'));
        if (!top) {
          json.fortnightly = 2;
        } else if (rowspan === 1) {
          json.fortnightly = 1;
        }
        return json;
      };
      _results = [];
      for (_i = 0, _len = all_lessons.length; _i < _len; _i++) {
        l = all_lessons[_i];
        if ($(l.cell).text().trim().length > 0) {
          _results.push(getLessonJson(l));
        }
      }
      return _results;
    };
    getWeekday = function(weekday) {
      var btm_rows, getLessons, i, rows, top_rows, _i, _results;
      rows = {};
      top_rows = $("." + weekday + ".top");
      btm_rows = $("." + weekday + ".btm");
      getLessons = function(index) {
        var arr1, arr2;
        arr1 = getRowJson(top_rows[index]);
        arr2 = getRowJson(btm_rows[index]);
        return arr1.concat(arr2);
      };
      _results = [];
      for (i = _i = 0; _i <= 4; i = ++_i) {
        _results.push(getLessons(i));
      }
      return _results;
    };
    weekdays = {};
    _ref = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat'];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      wd = _ref[_i];
      weekdays[wd] = getWeekday(wd);
    }
    return {
      weekdays: weekdays,
      year: $("#year")[0].value,
      semester: $("#sem")[0].value
    };
  };

}).call(this);
